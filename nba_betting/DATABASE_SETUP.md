# NBA Betting Database Setup

This document provides instructions for setting up the database tables required for the NBA betting prediction system.

## Overview

The system now uses Supabase as its database backend instead of CSV files. This provides several advantages:
- Centralized data storage
- Easier data management
- Real-time access to the latest data
- Integration with the web application

## Required Tables

The system relies on the following tables:

1. **player_history**: Historical player performance data
2. **player_teams**: Mapping between players and teams for each game
3. **fixtures_completed**: NBA game fixture data
4. **custom_projections**: Stores prediction results (created by our setup script)

## Setup Instructions

### 1. Create the Custom Projections Table

Run the setup script to create the `custom_projections` table:

```bash
python setup_db.py
```

This script will execute the SQL in `create_tables.sql` to set up the table and necessary indexes.

### 2. Test the Database Connection

You can verify that everything is working correctly by running the test script:

```bash
python test_predictions.py
```

This will:
1. Test the connection to the database
2. Create some sample projections
3. Read and display the projections
4. Optionally clean up the test data

### 3. Update API Token

For security reasons, update the API token in the following files:
- `app/api/run-predictions/route.ts`
- Any other files that access the API endpoint

Replace `YOUR_SECRET_API_TOKEN` with a strong, random token.

## Database Schema

### custom_projections

This table stores the prediction results:

| Column          | Type                    | Description                               |
|-----------------|-------------------------|-------------------------------------------|
| id              | SERIAL PRIMARY KEY      | Unique identifier                         |
| player_id       | TEXT                    | Player identifier                         |
| player_name     | TEXT                    | Player name                               |
| stat_type       | TEXT                    | Type of statistic (points, assists, etc.) |
| line            | NUMERIC                 | The betting line                          |
| projected_value | NUMERIC                 | Predicted value                           |
| confidence      | INTEGER                 | Confidence level (0-100%)                 |
| recommendation  | TEXT                    | OVER or UNDER                             |
| edge            | NUMERIC                 | Difference between prediction and line    |
| created_at      | TIMESTAMP WITH TIME ZONE| Creation timestamp                        |
| updated_at      | TIMESTAMP WITH TIME ZONE| Update timestamp                          |
| metadata        | JSONB                   | Additional metadata                       |

## Usage

Once set up, projections will be generated by:
1. Running the `run_predictions.py` script
2. Using the "Run Predictions" page in the web application
3. Calling the `/api/run-predictions` endpoint

The predictions will appear in:
1. The projections table in the database
2. The projections table in the web UI (`projections-table.tsx`)

## Troubleshooting

If you encounter any issues:

1. **Database Connection Errors**:
   - Verify that the Supabase URL and API key are correct
   - Check that the tables exist and have the expected structure

2. **Missing Data**:
   - Ensure that the player_history, player_teams, and fixtures_completed tables contain data
   - Run with `--refresh_data` to force a data refresh

3. **Projection Errors**:
   - Check the logs for specific error messages
   - Run with `--dry_run` to test without saving to the database 